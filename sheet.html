<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Agente | ANTAGONISTAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@500;600;700&family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS OTIMIZADO */
        :root { --bs-blue: #36A3EB; --bs-yellow: #F2E96B; --bs-red: #F25C5C; --dark: #1a1a1a; --white: #fff; --bg: #f4f4f9; }
        body { font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--dark); margin: 0; padding-bottom: 100px; }
        
        /* Header */
        header { background: var(--bs-blue); padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .logo { font-family: 'Permanent Marker'; font-size: 1.5rem; color: white; text-decoration: none; }
        .btn-back { background: rgba(0,0,0,0.2); color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; font-weight: bold; }

        /* Container */
        .container { max-width: 1100px; margin: 20px auto; padding: 0 15px; display: grid; gap: 20px; }
        .card { background: white; border: 2px solid var(--dark); border-radius: 10px; padding: 20px; box-shadow: 5px 5px 0 rgba(0,0,0,0.05); }
        .card h2 { margin-top: 0; border-bottom: 3px solid var(--bs-yellow); padding-bottom: 5px; color: var(--bs-blue); font-family: 'Orbitron'; display: flex; justify-content: space-between; align-items: center; }

        /* Identidade */
        .identity-grid { display: grid; grid-template-columns: 150px 1fr; gap: 20px; }
        .photo-box { width: 100%; height: 150px; background: #ddd; border: 2px solid var(--dark); display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: 'Rajdhani'; font-size: 1rem; }
        label { font-weight: bold; font-size: 0.9rem; text-transform: uppercase; display: block; margin-bottom: 3px; color: var(--bs-red); }
        .full-width { grid-column: 1 / -1; }

        /* Nível */
        .level-box { grid-column: 1 / -1; background: var(--dark); color: var(--bs-yellow); padding: 10px; text-align: center; border-radius: 5px; font-family: 'Orbitron'; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; }
        .level-controls button { background: var(--bs-yellow); border: none; font-weight: bold; cursor: pointer; padding: 2px 10px; font-size: 1.2rem; }

        /* Atributos Hex */
        .hex-grid { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin: 20px 0; }
        .hex { width: 80px; text-align: center; }
        .hex-shape { width: 70px; height: 80px; background: var(--bs-red); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); display: flex; align-items: center; justify-content: center; margin: 0 auto; color: white; font-size: 2rem; font-family: 'Orbitron'; }
        .hex-btns { display: flex; justify-content: space-between; margin-top: 5px; }
        .hex-btns button { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #ccc; cursor: pointer; font-weight: bold; }

        /* Status Bars */
        .bar-container { margin-bottom: 10px; }
        .bar-track { height: 25px; background: #ddd; border-radius: 12px; overflow: hidden; border: 2px solid #999; position: relative; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        .bar-text { position: absolute; width: 100%; text-align: center; top: 2px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black; }
        .hp-fill { background: var(--bs-red); }
        .pc-fill { background: var(--bs-blue); }
        .trans-fill { background: #8B0000; } 
        .energy-fill { background: #00FFFF; color: black; text-shadow: none; }

        /* Perícias */
        .skills-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 8px; max-height: 400px; overflow-y: auto; }
        .skill-row { display: flex; justify-content: space-between; align-items: center; background: #f8f8f8; padding: 5px 10px; border: 1px solid #eee; font-size: 0.9rem; }

        /* Listas (Inventário/Habilidades) */
        .btn-add { background: var(--dark); color: var(--bs-yellow); border: none; padding: 5px 15px; cursor: pointer; font-weight: bold; border-radius: 4px; font-size: 0.9rem; }
        .item-list { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
        .item-row { border: 1px solid #ddd; padding: 10px; border-left: 4px solid var(--bs-blue); background: #fafafa; position: relative; }
        .item-actions { margin-top: 5px; font-size: 0.8rem; display: flex; gap: 15px; }
        .action-link { color: var(--bs-blue); text-decoration: underline; cursor: pointer; font-weight: bold; }
        .action-remove { color: red; text-decoration: underline; cursor: pointer; }
        .upgrade-tag { background: #e0e0e0; padding: 2px 5px; border-radius: 3px; font-size: 0.75rem; margin-right: 5px; display: inline-block; margin-top: 3px; }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 20px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; border-radius: 10px; position: relative; }
        .modal-close { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 2rem; font-weight: bold; color: var(--bs-red); }
        .modal-list div { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .modal-list div:hover { background: #f0f0f0; padding-left: 15px; border-left: 3px solid var(--bs-blue); }

        /* Flux Creator Modal Styles */
        .flux-form { display: grid; gap: 10px; }

        /* Fab Save */
        .fab-save { position: fixed; bottom: 20px; right: 20px; background: var(--bs-blue); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer; border: none; z-index: 99; transition: 0.3s; }
        .fab-save:hover { transform: scale(1.1); background: var(--bs-yellow); color: var(--dark); }
    </style>
</head>
<body>

<header>
    <a href="index.html" class="logo">ANTAGONISTAS</a>
    <a href="heroes.html" class="btn-back">VOLTAR</a>
</header>

<div class="container">

    <div class="card">
        <div class="identity-grid">
            <div class="photo-box" id="photo-preview"><i class="fa-solid fa-user fa-3x"></i></div>
            <div class="info-grid">
                <div><label>Codinome</label><input type="text" id="name"></div>
                <div><label>Nome Civil</label><input type="text" id="civil"></div>
                <div><label>Classe</label>
                    <select id="class" onchange="updateClassMechanics()">
                        <option value="tecnologo">Tecnólogo</option>
                        <option value="monstruoso">Monstruoso</option>
                        <option value="catalisador">Catalisador</option>
                    </select>
                </div>
                <div><label>Idade</label><input type="number" id="age"></div>
                <div><label>Patente</label><input type="text" id="rank" value="Iniciante"></div>
                <div class="full-width"><label>Foto URL</label><input type="text" id="photo-url" oninput="updatePhoto()"></div>
            </div>
        </div>
        
        <div class="level-box" style="margin-top: 15px;">
            <span>NÍVEL: <span id="level-display">1</span></span>
            <div class="level-controls">
                <button onclick="changeLevel(-1)">-</button>
                <button onclick="changeLevel(1)">+</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>STATUS VITAL</h2>
        
        <div class="bar-container">
            <label>VIDA (PV): <span id="hp-txt">20/20</span></label>
            <div class="bar-track"><div class="bar-fill hp-fill" id="hp-bar" style="width: 100%;"></div><div class="bar-text" id="hp-overlay">20</div></div>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <input type="number" id="hp-curr" placeholder="Atual" onchange="updateBars()">
                <input type="number" id="hp-max" placeholder="Máx" readonly style="background:#e9e9e9;">
            </div>
        </div>

        <div class="bar-container">
            <label>CANSAÇO (PC): <span id="pc-txt">0/10</span></label>
            <div class="bar-track"><div class="bar-fill pc-fill" id="pc-bar" style="width: 0%;"></div><div class="bar-text" id="pc-overlay">0</div></div>
            <div style="display:flex; gap:5px; margin-top:5px;">
                <input type="number" id="pc-curr" placeholder="Atual" onchange="updateBars()">
                <input type="number" id="pc-max" placeholder="Máx" readonly style="background:#e9e9e9;">
            </div>
        </div>

        <div id="special-bar-container" class="bar-container" style="display:none;">
            <label id="special-label">TRANSFORMAÇÃO</label>
            <div class="bar-track"><div id="special-bar" class="bar-fill trans-fill" style="width: 0%;"></div><div class="bar-text" id="special-overlay">0</div></div>
            <input type="number" id="special-curr" value="0" onchange="updateBars()" style="margin-top:5px;">
        </div>

        <h3 style="margin-top:20px; font-size:1rem; color:var(--bs-blue);">ATRIBUTOS (Pontos Livres: <span id="attr-points">0</span>)</h3>
        <div class="hex-grid" id="hex-grid">
            </div>
    </div>

    <div class="card">
        <h2>PERÍCIAS</h2>
        <div class="skills-grid" id="skills-list">
            </div>
    </div>

    <div class="card">
        <h2>ARSENAL <button class="btn-add" onclick="openItemModal('weapon')">+ ARMA</button></h2>
        <div id="weapon-list" class="item-list"></div>
        
        <h2 style="margin-top:20px;">TRAJE</h2>
        <div id="suit-display" class="item-list"></div>

        <h2 style="margin-top:20px;">UTILITÁRIOS <button class="btn-add" onclick="openItemModal('item')">+ ITEM</button></h2>
        <div id="item-list" class="item-list"></div>
    </div>

    <div class="card">
        <h2>TÁTICAS <button class="btn-add" onclick="openTacticalModal()">+ APRENDER</button></h2>
        <div id="tactical-list" class="item-list"></div>

        <h2 style="margin-top:20px;">FLUXO (PODERES) <button class="btn-add" onclick="openFluxModal()">+ CRIAR</button></h2>
        <div id="flux-list" class="item-list"></div>
    </div>

    <div class="card">
        <h2>DOSSIÊ</h2>
        <div class="info-grid">
            <div class="full-width"><label>História</label><textarea id="history" rows="4"></textarea></div>
            <div class="full-width"><label>Personalidade</label><textarea id="personality" rows="3"></textarea></div>
            <div class="full-width"><label>Origem do Poder</label><textarea id="power-origin" rows="3"></textarea></div>
            <div class="full-width"><label>Relacionamentos & Sinergia</label><textarea id="relations" rows="3"></textarea></div>
        </div>
    </div>

</div>

<button class="fab-save" onclick="saveData()" title="Salvar Alterações"><i class="fa-solid fa-floppy-disk"></i></button>

<div id="list-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('list-modal')">&times;</span>
        <h2 id="modal-title">Selecione</h2>
        <div id="modal-body" class="modal-list"></div>
    </div>
</div>

<div id="flux-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal('flux-modal')">&times;</span>
        <h2>Engenharia de Fluxo</h2>
        <div class="flux-form">
            <label>Nome da Habilidade</label>
            <input type="text" id="flux-name">
            
            <label>Descrição do Efeito</label>
            <textarea id="flux-desc" rows="3" placeholder="Ex: Causa 1d8 de fogo em área..."></textarea>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div><label>Custo (PF)</label><input type="number" id="flux-cost"></div>
                <div><label>Custo Uso (PC)</label><input type="number" id="flux-use"></div>
            </div>
            
            <button class="btn-add" style="margin-top:10px; width:100%;" onclick="addFluxPower()">SINTETIZAR PODER</button>
        </div>
    </div>
</div>

<script src="script-data.js"></script>
<script src="script-sheet.js"></script>

</body>
</html>